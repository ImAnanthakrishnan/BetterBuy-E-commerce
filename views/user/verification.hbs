<!--<section class="container-fluid" >
    <div class="d-flex justify-content-center align-items-center" style="height: 650px;">
      {{#if err}}
      <div class="alert alert-warning" role="alert">
  {{message}}
</div>
{{/if}}
       <form action="/verify-otp" method="post"  class="  p-2  width">
        <h2 class="mb-3">OTP VERIFICATION</h2>
  <div class="mb-3">
    <label for="exampleInputOtp1" class="form-label">Enter the otp</label>
    <input type="text" class="form-control" id="exampleInputOtp1" name="otp">
  </div>
  <div class="">
    <label for="exampleInputOtp2" class="form-label"></label>
    <input type="hidden" value="{{otps}}" class="form-control" id="exampleInputOtp1" name="userId">
  </div>
   <div class="">
    <label for="exampleInputOtp3" class="form-label"></label>
    <input type="hidden" value="{{email}}" class="form-control" id="exampleInputOtp3" name="email">
  </div>
 
<div class="mb-3"><button type="submit" class="btn btn-primary">Submit</button> <span>or <a href="/">return to store</a></span></div>
</form>

<form action="/resend-otp" method="post" class=" p-2 width">
 <div class="">
    <label for="exampleInputOtp2" class="form-label"></label>
    <input type="hidden" value="{{otps}}" class="form-control" id="exampleInputOtp1" name="userId">
  </div>
   <div class="">
    <label for="exampleInputOtp3" class="form-label"></label>
    <input type="hidden" value="{{email}}" class="form-control" id="exampleInputOtp3" name="email">
  </div>
<button type="submit" class="btn btn-warning">Resend</button>
</form>
    </div>
 </section>-->
 
    <div
      class="position-relative overflow-hidden radial-gradient min-vh-100 d-flex align-items-center justify-content-center">
      <div class="d-flex align-items-center justify-content-center w-100">
        <div class="row justify-content-center w-100">
          <div class="col-md-8 col-lg-6 col-xxl-3">
            <div class="card mb-0">
              <div class="card-body">
                <a href="" class="text-nowrap logo-img text-center d-block py-3 w-100">
                  <img src="images/" width="180" alt="">
                </a>
                <h3 class="text-center mb-3">OTP VERIFICATION</h3>
               {{#if message}}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert" style="">
                      <strong> {{message}}</strong> 
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {{/if}}
                     {{#if smessage}}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert" style="">
                      <strong> {{smessage}}</strong> 
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {{/if}}
                     <!-- <div id="message-container">
                  <p id="message"></p>
                    </div>-->
                   
                  <div id="otpTimer" class="text-center mb-3"></div>
                 
                <form action="/verify-otp" method="post" id="form">
                  <div class="mb-2">
                    <label for="exampleInputPassword1" class="form-label">Enter Otp</label>
                    <input type="text" class="form-control" id="exampleInputPassword1" name="otp">
                    <div class="error text-danger"></div>
                    <input type="hidden" value="{{otps}}" class="form-control" id="exampleInputOtp1" name="userId">
                     <input type="hidden" value="{{email}}" class="form-control" id="exampleInputOtp3" name="email">
                     </div>
                  <button type="submit" class=" btn-primary w-100 py-8 fs-4 mb-4 rounded-2">Submit</button>
                  </form>
                  <div>
                    <p id="timer">01:00</p>
                  <form action="/resend-otp" method="post" class=" p-2 width">
                    <div class="mb-4">
                        <input type="hidden" value="{{otps}}" class="form-control" id="exampleInputOtp1" name="userId">
                        <input type="hidden" value="{{email}}" class="form-control" id="exampleInputOtp3" name="email">
                    </div>
                    <button type="submit" id="resendButton" class="btn btn-warning" style="display: none;">Resend</button>
                  </form>
                  </div>
                    <div class="d-flex align-items-center justify-content-center">
                    <p class="fs-5 mb-0 ">Go back to store?</p>
                    <a class="text-primary fw-bold ms-2" href="/signup">signup</a>
                  </div>
            
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
 
    <script>


const form = document.getElementById('form');
const otp = document.getElementById('exampleInputPassword1');
  form.addEventListener('submit',e=>{
e.preventDefault();
validateInputs();
});
const setError = (element,message)=>{
const inputControl = element.parentElement;
const errorDisplay = inputControl.querySelector('.error');

errorDisplay.innerText = message;
inputControl.classList.add('error');
inputControl.classList.remove('success');
}
const setSuccess = element=>{
const inputControl = element.parentElement;
const errorDisplay = inputControl.querySelector('.error');

errorDisplay.innerText = '';
inputControl.classList.add('success');
inputControl.classList.remove('error')
}
const validateInputs=()=>{
 const otpValue = otp.value.trim();

if(otpValue === ''){
  setError(otp,'Empty details are not allowed. Enter the otp')
}else if(otpValue.length<4 || otpValue.length>4){
  setError(otp,'Not a valid otp');
 }else{ 
  setSuccess(otp);
}

 const allInputsValid = document.querySelectorAll('.success').length === 1; // Adjust the count based on the number of input fields
 if (allInputsValid) {
   form.submit(); // Manually submit the form
 }
}

let timer;
  
  function startTimer(duration, element) {
    let timer = duration, minutes, seconds;
 const interval = setInterval(function () {
      minutes = parseInt(timer / 60, 10);
      seconds = parseInt(timer % 60, 10);

      minutes = minutes < 10 ? "0" + minutes : minutes;
      seconds = seconds < 10 ? "0" + seconds : seconds;

      element.textContent ="Resend otp-" +minutes + ":" + seconds;

      if (--timer < 0) {
        // Timer expired, show the resend button
        document.getElementById("resendButton").style.display = "block";
        clearInterval(interval);
          const timerElement = document.getElementById("timer");
  if (timerElement) {
    timerElement.parentNode.removeChild(timerElement);
  }
      }
    }, 1000);
  }

document.addEventListener("DOMContentLoaded", function () {
    const timerDuration = '{{ timerDuration }}';
    console.log(timerDuration);
    // Check if timerDuration is a valid number
    if (!isNaN(timerDuration) && timerDuration > 0) {
      const timerElement = document.getElementById("timer");
      // Start the timer
      startTimer(timerDuration, timerElement);
    } else {
      // Handle invalid timer duration
      console.error("Invalid timer duration:", timerDuration);
    }
  });




       /*function updateOTPTimer() {
    const currentTime = new Date().getTime();
    const expiresAt = new Date('{{expiresAt}}').getTime();
   // const expiresAt = new Date(document.querySelector('[data-expires-at]').getAttribute('data-expires-at')).getTime();
   

    const timeRemaining = expiresAt - currentTime;
    const timerElement = document.getElementById("otpTimer");

    if (timeRemaining > 0) {

      const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
      timerElement.innerHTML = `Time remaining: ${seconds} seconds`;
    } else {
      timerElement.innerHTML = "OTP has expired";
      clearInterval(timerInterval)
    }
  }

 function startOTPTimer() {
  updateOTPTimer();  // Initial call to set the timer
  // Call the updateOTPTimer function every second
  timerInterval = setInterval(updateOTPTimer, 1000);
}

// Call the startOTPTimer function when the page loads or when you want to start the timer
startOTPTimer();
       /* $(document).ready(function() {
            // Event listener for the button click
            $('#updateButton').on('click', function() {
                // Make an AJAX request to the server
                $.ajax({
                    method: 'POST',
                    url: '/signup',
                    success: function(data) {
                        // Update the message and style on the page
                        $('#message').text(data.message).attr('style', data.style);
                    },
                    error: function(err) {
                        console.error('Error updating message:', err);
                    }
                });
            });
        });*/
    </script>